(function(){function t(t,s){i(t);var r=t.xtag.request||{};t.xtag.request=s;var a=t.xtag.request,l=(t.getAttribute("data-callback-key")||"callback")+"=xtag.callbacks.";if(xtag.fireEvent(t,"beforerequest")===!1)return!1;if(r.url&&!s.update&&r.url.replace(RegExp("&?("+l+"x[0-9]+)"),"")==t.xtag.request.url)return t.xtag.request=r,!1;if(t.setAttribute("src",t.xtag.request.url),o.href=s.url,~o.href.indexOf(window.location.hostname))a=xtag.merge(new XMLHttpRequest,a),a.onreadystatechange=function(){t.setAttribute("data-readystate",a.readyState),4==a.readyState&&400>a.status&&e(t,a)},["error","abort","load"].forEach(function(e){a["on"+e]=function(i){i.request=a,xtag.fireEvent(t,e,i)}}),a.open(a.method,a.url,!0),a.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),a.send();else{var h=a.callbackID="x"+(new Date).getTime();t.setAttribute("data-readystate",a.readyState=0),xtag.callbacks[h]=function(n){a.status=200,a.readyState=4,a.responseText=n,e(t,a),delete xtag.callbacks[h],i(t)},a.script=document.createElement("script"),a.script.type="text/javascript",a.script.src=s.url=s.url+(~s.url.indexOf("?")?"&":"?")+l+h,a.script.onerror=function(e){t.setAttribute("data-readystate",a.readyState=4),t.setAttribute("data-requeststatus",a.status=400),xtag.fireEvent(t,"error",e)},n.appendChild(a.script)}t.xtag.request=a}function e(t,e){return e!=t.xtag.request?xtag:(t.setAttribute("data-readystate",e.readyState),t.setAttribute("data-requeststatus",e.status),xtag.fireEvent(t,"dataready",{request:e}),t.dataready&&t.dataready.call(t,e),void 0)}function i(t){var e=t.xtag.request;return e?(e.script&&~xtag.toArray(n.children).indexOf(e.script)?n.removeChild(e.script):e.abort&&e.abort(),void 0):xtag}var n=document.querySelector("head"),o=document.createElement("a");o.href="",xtag.callbacks={},xtag.mixins.request={lifecycle:{created:function(){this.src=this.getAttribute("src")}},accessors:{dataready:{get:function(){return this.xtag.dataready},set:function(t){this.xtag.dataready=t}},src:{set:function(e){e&&(this.setAttribute("src",e),t(this,{url:e,method:"GET"}))},get:function(){return this.getAttribute("src")}}}}})();