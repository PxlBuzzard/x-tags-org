<!DOCTYPE html>
<html lang="en">

	<head>
		<meta charset="utf-8" />
		
		<title>X-Tag - Web Components Custom Element Polylib</title>
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
		<link href="images/shortcut.png" rel="shortcut icon" type="image/x-icon" />
		
		<link rel="stylesheet" type="text/css" href="/css/reset.css" />
		<link rel="stylesheet" type="text/css" href="/css/flex.css"/>
		<link rel="stylesheet" type="text/css" href="/css/layout.css"/>
		<link rel="stylesheet" type="text/css" href="/css/global.css"/>
		<link rel="stylesheet" type="text/css" href="/elements/slidebox/slidebox.css"/>
		<link rel="stylesheet" type="text/css" href="/elements/panel/panel.css"/>
		<link rel="stylesheet" type="text/css" href="/elements/ribbon/ribbon.css"/>
		<link rel="stylesheet" type="text/css" href="/elements/code-prism/code-prism.css"/>
		<link rel="stylesheet" type="text/css" href="/elements/template/template.css"/>
		<link rel="stylesheet" type="text/css" href="/elements/growbox/growbox.css"/>

		{% block styles %}{% endblock %}
		
		<link type="text/css" rel="stylesheet" href="https://fonts.googleapis.com/css?family=Righteous" />
		
		<script type="text/javascript" src="/js/x-tag.js"></script>
		<script type="text/javascript" src="/js/nunjucks-dev.js"></script>
		<script type="text/javascript" src="/elements/slidebox/slidebox.js"></script>
		<script type="text/javascript" src="/elements/panel/panel.js"></script>
		<script type="text/javascript" src="/elements/ribbon/ribbon.js"></script>
		<script type="text/javascript" src="/elements/code-prism/code-prism.js"></script>
		<script type="text/javascript" src="/elements/template/template.js"></script>
		<script type="text/javascript" src="/elements/growbox/growbox.js"></script>
	</head>

<body>

	<header id="header">
	
		<div id="global_nav">
			<x-slidebox>
				<x-slides>				
					
					<x-slide {% if page == "blog" %}selected{% endif %}>
						<a>Blog</a>
					</x-slide> 
					
					
					<x-slide {% if page == "docs" %}selected{% endif %}>
						<a>Docs</a>
					</x-slide>
					
					<x-slide id="nav_logo" {% if page == "index" %}selected{% endif %}>
						<span>&lt;</span>
						<div>x</div>
						<span>&gt;</span>
					</x-slide>
					
					
					<x-slide {% if page == "registry" %}selected{% endif %}>
						<a>Registry</a>
					</x-slide>
					
					
					<x-slide {% if page == "about" %}selected{% endif %}>
						<a>About</a>
					</x-slide>
					
					
				</x-slides>
			</x-slidebox>
		</div>
		
	</header>

	<x-slidebox id="content_slidebox">
		<x-slides>		
			
			<x-slide name="blog" {% if page == "blog" %}selected{% endif %}>
				<x-panel>
					{% block blog %}{% endblock %}
				</x-panel>
			</x-slide>
			

			<x-slide name="docs" {% if page == "docs" %}selected{% endif %}>
				<x-panel>
					{% block docs %}{% endblock %}
				</x-panel>
			</x-slide>
			
			<x-slide name="index" {% if page == "index" %}selected{% endif %}>
				<x-panel>
					{% block index %}{% endblock %}
				</x-panel>
			</x-slide>

			
			<x-slide name="registry" {% if page == "registry" %}selected{% endif %}>
				<x-panel>
					{% block registry %}{% endblock %}
				</x-panel>
			</x-slide>

			
			<x-slide name="about" {% if page == "about" %}selected{% endif %}>				
				<x-panel>
					{% block about %}{% endblock %}
				</x-panel>
			</x-slide>

		</x-slides>
	</x-slidebox>

{% block bodyEnd %}{% endblock %}
	


<script type="text/javascript">
	window.onpopstate = function(e){
		if(e.state){
			slidePage(e.state.index,true);
		}
	}
	introImageLoads = 0;
	introAnimation = function(){
		introImageLoads++;
		if (introImageLoads == 2) {
			setTimeout(function(){
				document.getElementById('intro_graphic').className = 'animate-intro';
				setTimeout(function(){
					document.querySelector('#intro_logo div').className = 'switch-logo-x';
					document.getElementById('intro_graphic').className = 'animate-intro fade-intro';
				}, 300);
			}, 1000);
		}
	}
	
	slidePage = function(index,pop){
		var slide = document.querySelectorAll('#content_slidebox x-slide')[index];
		var url = "/" + slide.getAttribute('name');
		if (slide.firstElementChild.children.length == 0){
			slide.firstElementChild.src = url + "?frag";
		}
		if(!pop && location.pathname != url){
			history.pushState({page:slide.getAttribute('name'), index:index}, slide.getAttribute('name'), slide.getAttribute('name'));
		}
		document.querySelector('#global_nav x-slidebox').slideTo(index);
		document.getElementById('content_slidebox').slideTo(index);
	}
	
	xtag.addEvents(document, {
		'click:touch:delegate(#global_nav x-slide)': function(e){
			var index = Array.prototype.indexOf.call(this.parentNode.children, this);
			slidePage(index);
		},
		'click:touch:delegate(#registry_elements)': function(){
			slidePage(2);
		}, 
		'click:touch:delegate(#search_btn)': function(){
			
			var elem = document.getElementById('search_result_json_p');
			if (!elem){
				elem = document.createElement('script');
				document.body.appendChild(elem);
			}
			category = [];
			var query = document.getElementById('search_query').value.replace(/#(\w+)/g, function(match,group1,idx){
				category.push(group1);
				return '';
			});
			elem.src = "http://registry.x-tags.org/search?callback=search_results&query=" + 
				query + "&category=" + category.join(',');
		},
		'keydown:keypass(13):delegate(#search_query)': function(e){
			xtag.fireEvent(document.getElementById('search_btn'), 'click');
		}
	});

	window.search_results = function(results){
		var container = document.getElementById('search_results');
		container.innerHTML = "";
		results.data.forEach(function(row){
			var item = document.createElement('x-search-result');
			item.templateData = row;
			container.appendChild(item);
		});
	}
	
</script>

{% block scripts %}{% endblock %}
{% include "templates/search_result.html" %}

</body>

</html>
